First version of the code that later is refactored.